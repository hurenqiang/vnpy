write by hurenqiang

created 2016.03.17

< 作业 > 模拟低频交易和高频交易的市场：
        假设 A[1...N] 为散户，根据低频操作，日K线，双均线交叉
        假设 B 为庄家，根据1h线操作
        极端情况下：在未形成均线多头条件下，B左右手交易，理论上只损失手续费
            B自成交，拉升，出现双均线金叉
            第二日，A出现买入信号买入，B造势高开，卖出给A，
            后续N日A继续持有，B自成交造成股票下跌，出现死叉
            第二日，A出现死叉卖出信号，B造势低开，买入A卖出的股票
            这样，B将赚得 A卖出价-A买入价的 价差收益  - B自成交手续费
            如此往复，B将逐渐累积收益，而最终将由散户接盘
            不断更新的A韭菜将成为真正的牺牲者
        当然，现实情况不会如此简单，市场上各色的交易者使庄家无法轻易控制走势，因此需要借助于大盘和个股消息...
        并做好仓位管理，低买高卖控制成本，拉升吸引其它投机客并顺机出货
        问题是：同一只股票中多空博弈双方本就不一致，如何达到有效的监测其意图呢？


< 思考 > 程序化交易:
        一种说法：
        技术指标买点的概率意义：惯性的大小；好的买点，后续出现惯性趋势的统计可能性更大；噪音（坏买点），惯性不按预期持续
        卖点的意义：止损+止盈（）
        一个正期望的买点+一个合理的卖点：护住本钱，放大盈利
        最大的敌人：未经回测验证的情绪冲动（量化型），未经经验佐证的冲动（主观型）
        临时看盘突然进行买卖感觉是量化的最大敌人（不可冲动）
        
< 思考 > 妖股、游资：
         主力需要资金雄厚（拉升，边拉边出，博取极大的利益），有极高的炒作认可度（资金流入？）
         如果多游资接力，需要有击鼓传花的新资金进入，一旦击鼓传花效应消失，将一泻千里

< 规则 > 认真研究规则，找到规则之外的灰色地带，灰色的地方，就是大资金流动的地方，找到并跟随
         认真研究规则
 
< 思考 > 考虑高频交易的操纵：
        如果资金足够充裕，考虑在1.01 * 1.02的bookorder，足够多的单子封死1.01和1.02则别人只能以1.02买入和1.01卖出，可以赚钱0.01的差价
        事实上不可能如此，但主力却可以利用类似的办法高抛低吸，在市场上涨时，如果想压制股价，则抛出筹码
        待股价下跌到合适的位置后，以低价吸入筹码并稳定下跌趋势
        当前，前提是主力有足够的筹码和能力对股票形成这样的操作，合理利用市场变化造势，减少自我的成本
        同时，没有与主力势均力敌的其它对手盘做反方向操作，如果有，那么强势的一方才是真正的主力
        如果能够有办法建模主力操作的模式，则有方法寻找买点与卖点

        主力资金：可能随时发生变化，不同周期下，主力资金的看法随时发生逆转
        假设：最高点与最低点附近都是主力资金在操作（因为这是高抛低吸造成的，而主力是制造者）....是否能分析出什么？
        最关键的是，是否能以高概率判断是否有主力在其中操作？？？？所以，需要再次研读一下 王立新 那一篇文章
        做法：
        第一步 找出市场上主力因子最强的N只股票
        第二步 近期企稳，步入主升浪的股票，择低点买入（比如）
              或者，找近期跌幅最大的股票操作
        如何找出主力，且有做多主力意愿的股票...

< 思考 > 在金融领域，高深的学习算法有时候难以使用或使用效果不佳的一个原因在于：信息丢失。
    在语音处理、信号识别、图像处理中，原始数据最大程度上保留了原始信息，其它各种算法在于去除噪音，提取最原始最有效的信息。
    而在股票、期货市场，价格曲线并不是数据的全部，相反，它只是众多原始信息综合作用之后的一个结果
    事件、市场、散户心态、主力思考、政策、天气、意外事件，等等，都能对价格数据产生影响
    另外，好的训练样本与建模思路需要匹配，否则错误的数据样本将造成错误
    1 - 假定信息，再从中提取信息？
    2 - 寻找价格的变动模式？？？ 不管是机器学习还是其它分类算法都是如此： 主流的做法
    3 - 套利策略
    4 - 无风险寻找bug：错误的市场行为中找寻机会
    对于大资金呢？心理分析市场分析，引导市场的一定走向？博取低吸高抛的机会？
    小资金呢？寻找大资金的思路，寻找价格的变动模式，寻找风险的对冲方式？
    什么是模型：
    什么是指标的交易模式：上下穿、极值、背离、阈值、高点低点

< 模型 > 涨跌停开板模型：
    author：hurenqiang
    利用期货涨跌停开板瞬间介入，跟随开板的力量赚钱
    单边力量衰减后立刻退出头寸
    纯投机，不要犹豫
    优先实现这个模型

< 模型 > 模式开仓：
    author：符合一定模式之后进行开仓, 计算综合指标
    分类器与训练识别: 优质的样本，即蕴含真实可识别特征的样本

< 模型 > boll布林带变体模型
    author: hurenqiang
    想法：只做横盘整理或震荡后，波动变大走出一段单边的走势
         波动变大的意义：1是短时间内价格迅速变动，2是波动变大走出单边走势
         形象的说，就是布林带变窄持续一段时间比如20个周期或者bar，然后价格波动突破上轨或者下轨
         最大的问题是如何识别出何为噪声何为真实的信号？？？
         中线 = average(P, N)
         上轨 = 中线 + k1*标准差
         下轨 = 中线 - k2*标准差
         止损：一段时间内并未按照预期的方式出现波动，则止损 + 固定额度止损
         止盈：盈利后如果出现反方向波动到一定幅度，则止损

         可以叠加大趋势过滤器，只做方向相同的头寸


< 模型 > 变长range bar的模型
from: vn.py群 印钞机
    变长bar的PCNN思路
    基于tick级别粒度生成变长K线range bar，思路如下：
    1 - 大趋势：识别市场状态（单边/震荡）
    2 - 变长range bar: 
        变长bar固定O-C价格差（非H-L价格差），带单影线的K线，O或者C等于H或L，且影线不产生新一根bar（双方向还可以不一致，具体需要研究变长bar生成策略）
        单边 短，震荡 长：这样单边情况下生成的bar数量更多，震荡下少，bar越多则交易机会越多
        转折数量越少说明趋势越明显，这样的品种越应该考虑
        为了一致性，整点时间时产生自然截断，生成新的bar

        以上两者互相影响：趋势影响bar长度，bar长度影响bar的数量进而影响趋势的识别策略
    3 - 交易算法

    00- PCNN识别趋势状态，识别bar长度
        买卖信号
        日内交易策略

< 模型 > 偏高频套利策略
from 优矿
    基于日内高低点数据统计的交易策略
    -   N（300）日内高低点出现在各个时间段的分布(如: 高点 第一小时 40%  第二小时 10%  第三小时 15% 第四小时 35%)  也可以为统计区间平均价的高低（如TWAP，VWAP）等
                                   (如: 低点 第一小时 35%  第二小时 15%  第三小时 14% 第四小时 36%)
    -   先建仓，然后每天做T策略如下：
        既然第一个小时有40%的概率为高点，那么可以卖出40%的股票，同时买入35%的股票，综合为卖出5%
        余下时间类似
    -   寄希望于整个过程能够产生符合高低点策略的财务回报
        可以统计市场时间段平均价代替最高最低价
    -   风险： 1 这个概率是否是一个稳定的现象，是否可以选股以选择更合适的操作品种
              2 是否有足够高的收益覆盖成本
              3 建仓多少才能够有足够的收益

< 小知识 >  数据处理基本方法 
from 优矿
    去极值化 winsorize：根据样本计算平均值和标准差, 平均值±3标准差意外的数据取边界值，如：市值等可以考虑，消除极值因子的影响
    中性化  neutralize：对于不同行业的股票，其PE基准值可能不一样，无法直接比较，中性化处理后可以进行比较
    标准化  standardize：(因子值 - 因子均值)/因子标准差, 这样不同因子之间才可进行比较分析或者加权计算

< 小知识 >  量化投资基本流派

< 思考 > 海龟交易法则

< 小知识 > 凯利公式
    资金大了之后的有效管理方式
    f = (pb - q)/b  p: 胜率  q: 败率  b: 净赢率(loss为1情况下的简要计算值)
    f = p - q/(w/l) w: win净盈率  l: loss净损率  或者 简单计算为 f = p -q/r   其中 r = w/l 即赔率
    f: 仓位比例

< 熔断超跌错杀股的一种判断方式 >
    第一次熔断为红盘，第二次熔断时杀跌
    首次熔断前小跌，第二次熔断杀跌
    首次熔断后杀跌，但有明显拉升，且第二次熔断后价格竟然高与第一次熔断价格

< 技术指标 >
    MA: sum(price[0:N])/N
    ATR: 真实波动幅度
        TR  = max(high - low, high - lastClose, lastClose - low)
        stdTR = tr / close
        ATR = average(TR[0:N])
        stdATR= average(stdTR[0:N])
    AMA:
    MACD:
    DBCD:
    KDJ:
    RSI:
    zigzag:
    itrend:
        price = (high + low)/2.0;
        if (bars.len() < 7){
            // 初始Trend的计算
            if (bars.len() >= 3){
                trend = (price + 2*price[1] + price[2])/4;
            }
        }else{
            trend = (alpha - alpha*alpha/4)*price + 0.5*alpha*alpha*price[1] -
                    (alpha-0.75*alpha*alpha)*price[2]
                    + 2*(1-alpha)*trend[1] - 
                    (1-alpha)*(1-alpha)*trend[2]
        }