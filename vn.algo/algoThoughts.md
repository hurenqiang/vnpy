write by hurenqiang

created 2016.03.17
< 思考 > 波动模型：
        模型不考虑趋势，只考虑K线的波动，当波动变大时，认为有行情来临，按照短期运动方向开仓，设置好止损
        当波动降低后，平仓
        与趋势策略不同的时，模型只考虑短期剧烈波动的方向，或者说动量（也许叫做动量模型更合适？？？沿着动量方向运行的惯性）
        注意：不要破坏趋势造成的盈利，趋势中一定要赚钱；或者，趋势与回归策略需要同时配置，但至少需要配置上趋势策略

< 思考 > 如果一个策略能够非常稳定的盈利（年华p%），但容量有限（N亿资金量）
        如果资金量大于一定程度时，盈利比率降低为q%，容量为M
        所以可能存在一个平衡点
        同理，如果使用此模型对外操作资金产品，其带来的分红收益可能尚不及自身拿资金自营
        因此，如果考虑是否将一个非常优秀的模型拿出来给公司操作产品时，需要考虑其盈利是否比自身操作来得更多，否则，可能仅用于自营产品身上

        如何设计出一个小容量但稳定盈利的模型呢？？？？？？？保证自己先存活下来.......
        其实一个模型最小容量应该都能够达到百万级规模...除非流动性确实太低

        关键问题来了：怎么先挣到足以钱生钱养活自己的情况呢？
        就算有100w，也需要年华20%才足够，1000w需要年华2%，所以咯，本金当然是越高越好
        首先挣到500w吧......加油咯~~~~~~~~

< 思考 > 关于工作与自由  2016-04-08
        现在的工作，其实压力不大，其实有足够多的自由，领导并未强制要求什么，主要靠自己
        然而为什么感觉有压力且沉闷呢？上下班时间，二是没有动力；但既然给了份额，那总应该有一点动力了吧
        最重要的，可能是自己的心不静，没有一个极大的动力去做这一切
        如何坚定自己的决心，给自己信心，实现自己的财务自由之路！！！！！！！
        时间其实是很自由的，需要花时间自己去沉浸进入那样的圈子，那样的工作态度
        一切的一切，加油！！！！！！

        建立自己的量化认知和看法：
        P宗
        程序化交易系统的组成部分
        程序化交易策略的组成部分
        常见指标的计算方式、用法，需要铭记于心
        复盘的意义是什么，怎么复盘
        情绪化
        量化投资：怎么能够赚钱
        高频交易：基本认识
        市场微结构与量化策略的关系：
        如何评价策略
        风险控制
        海龟交易法则
        工具
        实时交易的问题与挑战
        回测框架
        人工智能

< 思考 > alpha与beta：beta是市场平均收益，alpha是超额收益
         动量与反转：两者在牛/熊市有不一样的表现，且动量与反转的有利周期不一致
         股票市值上升阻力：25，50，200，400，800，如何理解市值天花板现象？如何利用？
         虽然是炒作，但股票也需要有想象的市值空间，因此概念是股票的一大估值因素？

< TB > tb_hufo:xdlll322

< 思考 > 讲道理？讲数据？
         Quant的P、Q之争
         Q：讲模型
         P：讲数据

< 思考 > 主力的优势在哪里？散户为什么容易被操纵（低卖高买）？
        对散户建模逆向操作: 错误的方法有千百种，但有固定一定亏损的可能的吗？错误的方法只是可能没有一直坚持到最后而已
        对主力建模正向操作: 是否需要完全正确的建模才能得到正的收益？有偏差的建模能否产生相似的效果？


< 学习 > 阅读思考：
        wanglixin  fuzzywanglixin
        blog.sciencenet.cn/home.php?mod=space&uid=2999994
        混沌理论、卡尔曼滤波、MACD、KDJ、RSI、均线、分形、状态方程、模糊控制
        搜索：全球部分免费开放的电子图书馆

< 思考 > 关于管理
        钱：固定收益与激励措施
        心情：干的开不开心
        时间：是否有足够的自我支配时间

< 策略 > 基于MACD的交易策略
        过滤器：大方向的状态判断
        交易机制：交易细节与操作

< 作业 > 模拟低频交易和高频交易的市场：
        假设 A[1...N] 为散户，根据低频操作，日K线，双均线交叉
        假设 B 为庄家，根据1h线操作
        极端情况下：在未形成均线多头条件下，B左右手交易，理论上只损失手续费
            B自成交，拉升，出现双均线金叉
            第二日，A出现买入信号买入，B造势高开，卖出给A，
            后续N日A继续持有，B自成交造成股票下跌，出现死叉
            第二日，A出现死叉卖出信号，B造势低开，买入A卖出的股票
            这样，B将赚得 A卖出价-A买入价的 价差收益  - B自成交手续费
            如此往复，B将逐渐累积收益，而最终将由散户接盘
            不断更新的A韭菜将成为真正的牺牲者
        当然，现实情况不会如此简单，市场上各色的交易者使庄家无法轻易控制走势，因此需要借助于大盘和个股消息...
        并做好仓位管理，低买高卖控制成本，拉升吸引其它投机客并顺机出货
        问题是：同一只股票中多空博弈双方本就不一致，如何达到有效的监测其意图呢？

< 市场微结构 >
        策略的设计是否依赖于对市场微结构的分析？即参与者的情况
        1、从市场特征入手，分析市场交易特征，形成交易策略，以解释市场行为入手
        2、从市场结果入手，发现规律，以指标佐证
        3、统计入手，机器学习，寻找无法客观解释的交易策略
        其实最重要的，生命周期内赚钱，能够存活，赚大钱更好（策略本身随时可能失效）

< 策略分类 >
        趋势型（包括反转）
        中性策略 (对冲，包含一部分趋势的思想，一个比一个更差)
        套利（制造产品组合构成不合理定价的回归趋势）
        高频交易（依靠交易规则、市场交易微观结构，博取微小利益，积少成多）甚至不关注大趋势，只关注交易细节情况

< 思考 > 如何定义一个好的品种+好的策略（趋势型与反转型策略）
        开仓：开仓的目的是盈利，因此预期为有正收益方向的惯性力量（统计特征），同时辅以止损
        如何定义一个好的策略：开仓之后不会轻易被止损，有较强的惯性运动特征使之往正收益分析前进
        那么好的品种：就是趋势容易出现，一但出现趋势有较强的惯性运动特征，不轻易反向运动
        品种的惯性是怎么来的：庄家获利需要一定的幅度，趋势的自强化过程，交易者的相互作用（）
        交易者的相互作用（不同的交易者使用不同的策略进行交易，但反应到执行结果上只有买入、卖出、持有，造成价格波动的则为买入与卖出
        因此，当一方的力量更加强势时，价格朝着强势一方的方向运动）
        运动逐渐累积，不同风格交易者轮流使用策略交易，形成新的交易方向
        圣杯就是能够快人一步找到强势一方的因子（概率统计上的）
        由于市场波动性，有时价格会被操纵一时，此时圣杯可能会失效（比如期货脱离基本面的价格变化）
        圣杯不是只有一个，圣杯是有时间限制的，圣杯是市场共同作用下的一个惯性条件的识别因子，圣杯需要不断的寻找
        越是有效而成熟的市场，圣杯越少
        因此，圣杯是什么，与市场参与者有关，与参与者使用的交易策略有关
        同样的策略，会造成策略逐步失效，削减策略的有效性，策略的收益被最快速的发现者获取
        同一个系列的交易策略变种，能产生自强化，导致趋势变化加剧，反应慢的策略将成为牺牲品
        同一系列的交易策略【快，中，慢】
        其使用者的力量将决定是否构成足够的趋势强化力，如果[快]者太过于敏感，则可能承受后期无法形成有利惯性的可能
        因此，一切需要基于统计意义进行考虑

        最危险的圣杯：股价操纵
        最有效的圣杯：内幕消息
        最合理的圣杯：快人一步
        最屌丝的圣杯：聪明一点
        最有福的圣杯：大智若愚
        最出色的圣杯：基本面

        虽然交易者很少认识到这个道理，但寻找策略的本质与此是一致的，只不过方法不一样，条条大路通罗马
        比如事件驱动：事件 -> 趋势惯性运动
        比如多因子选股：多因子特征能够使投资组合有更好的惯性运动的可能
        比如择时：最明显的想找到一个惯性特征，不管是明确的指标择时还是各类机器学习算法的择时
        主题轮动、行业轮动、大小盘、季节、低价、市值、市场情绪、新闻热点、钟摆理论、动量、动量反转 等等
        有的具有一定的对冲思想，有的想找到alpha特征，但都是基于趋势的延续或者反转（反转亦是一种惯性，即减速度造成的惯性回归）
        仍有一定需要注意：不同的惯性策略有不一样的思考方式，不能完全套用

        一切择时的策略：寻找惯性运动的概率（？？？？？？）

        造成价格运动的因素在于价格之外(基本面、供需、消息、事件、黑天鹅
        但是我们只有从已经反映出来的价格中重新寻找规律，寻找惯性运动的值......(这是一个概率性求解的过程)
        重复性的工作，寻找最大化收益的过程


< 思考 > 程序化交易:
        一种说法：
        技术指标买点的概率意义：惯性的大小；好的买点，后续出现惯性趋势的统计可能性更大；噪音（坏买点），惯性不按预期持续
        卖点的意义：止损+止盈（）
        一个正期望的买点+一个合理的卖点：护住本钱，放大盈利
        对于资金量大而言：分次买入、分次卖出、止损止盈的同时考虑如何最大化收益期望值
        最大的敌人：未经回测验证的情绪冲动（量化型），未经经验佐证的冲动（主观型）
        临时看盘突然进行买卖感觉是量化的最大敌人（不可冲动）
        对于小资金而言：同样需要考虑到仓位的问题，不可随时随地满仓，逐步建仓，有安全垫之后再可多投入且预留失败后需要重新回本的资金量
        抓住一次机会，hold住，然后适时套现

< 思考 > 妖股、游资：
         主力需要资金雄厚（拉升，边拉边出，博取极大的利益），有极高的炒作认可度（资金流入？）
         如果多游资接力，需要有击鼓传花的新资金进入，一旦击鼓传花效应消失，将一泻千里

< 规则 > 认真研究规则，找到规则之外的灰色地带，灰色的地方，就是大资金流动的地方，找到并跟随
         认真研究规则
 
< 思考 > 考虑高频交易的操纵：
        如果资金足够充裕，考虑在1.01 * 1.02的bookorder，足够多的单子封死1.01和1.02则别人只能以1.02买入和1.01卖出，可以赚钱0.01的差价
        事实上不可能如此，但主力却可以利用类似的办法高抛低吸，在市场上涨时，如果想压制股价，则抛出筹码
        待股价下跌到合适的位置后，以低价吸入筹码并稳定下跌趋势
        当前，前提是主力有足够的筹码和能力对股票形成这样的操作，合理利用市场变化造势，减少自我的成本
        同时，没有与主力势均力敌的其它对手盘做反方向操作，如果有，那么强势的一方才是真正的主力
        如果能够有办法建模主力操作的模式，则有方法寻找买点与卖点

        主力资金：可能随时发生变化，不同周期下，主力资金的看法随时发生逆转
        假设：最高点与最低点附近都是主力资金在操作（因为这是高抛低吸造成的，而主力是制造者）....是否能分析出什么？
        最关键的是，是否能以高概率判断是否有主力在其中操作？？？？所以，需要再次研读一下 王立新 那一篇文章
        做法：
        第一步 找出市场上主力因子最强的N只股票
        第二步 近期企稳，步入主升浪的股票，择低点买入（比如）
              或者，找近期跌幅最大的股票操作
        如何找出主力，且有做多主力意愿的股票...

< 思考 > 在金融领域，高深的学习算法有时候难以使用或使用效果不佳的一个原因在于：信息丢失。
    在语音处理、信号识别、图像处理中，原始数据最大程度上保留了原始信息，其它各种算法在于去除噪音，提取最原始最有效的信息。
    而在股票、期货市场，价格曲线并不是数据的全部，相反，它只是众多原始信息综合作用之后的一个结果
    事件、市场、散户心态、主力思考、政策、天气、意外事件，等等，都能对价格数据产生影响
    另外，好的训练样本与建模思路需要匹配，否则错误的数据样本将造成错误
    1 - 假定信息，再从中提取信息？
    2 - 寻找价格的变动模式？？？ 不管是机器学习还是其它分类算法都是如此： 主流的做法
    3 - 套利策略
    4 - 无风险寻找bug：错误的市场行为中找寻机会
    对于大资金呢？心理分析市场分析，引导市场的一定走向？博取低吸高抛的机会？
    小资金呢？寻找大资金的思路，寻找价格的变动模式，寻找风险的对冲方式？
    什么是模型：
    什么是指标的交易模式：上下穿、极值、背离、阈值、高点低点

< 模型 > 涨跌停开板模型：
    author：hurenqiang
    利用期货涨跌停开板瞬间介入，跟随开板的力量赚钱
    单边力量衰减后立刻退出头寸
    纯投机，不要犹豫
    优先实现这个模型

< 模型 > 模式开仓：
    author：符合一定模式之后进行开仓, 计算综合指标
    分类器与训练识别: 优质的样本，即蕴含真实可识别特征的样本

< 模型 > boll布林带变体模型
    author: hurenqiang
    想法：只做横盘整理或震荡后，波动变大走出一段单边的走势
         波动变大的意义：1是短时间内价格迅速变动，2是波动变大走出单边走势
         形象的说，就是布林带变窄持续一段时间比如20个周期或者bar，然后价格波动突破上轨或者下轨
         最大的问题是如何识别出何为噪声何为真实的信号？？？
         中线 = average(P, N)
         上轨 = 中线 + k1*标准差
         下轨 = 中线 - k2*标准差
         止损：一段时间内并未按照预期的方式出现波动，则止损 + 固定额度止损
         止盈：盈利后如果出现反方向波动到一定幅度，则止损

         可以叠加大趋势过滤器，只做方向相同的头寸


< 模型 > 变长range bar的模型
from: vn.py群 印钞机
    变长bar的PCNN思路
    基于tick级别粒度生成变长K线range bar，思路如下：
    1 - 大趋势：识别市场状态（单边/震荡）
    2 - 变长range bar: 
        变长bar固定O-C价格差（非H-L价格差），带单影线的K线，O或者C等于H或L，且影线不产生新一根bar（双方向还可以不一致，具体需要研究变长bar生成策略）
        单边 短，震荡 长：这样单边情况下生成的bar数量更多，震荡下少，bar越多则交易机会越多
        转折数量越少说明趋势越明显，这样的品种越应该考虑
        为了一致性，整点时间时产生自然截断，生成新的bar

        以上两者互相影响：趋势影响bar长度，bar长度影响bar的数量进而影响趋势的识别策略
    3 - 交易算法

    00- PCNN识别趋势状态，识别bar长度
        买卖信号
        日内交易策略

< 模型 > 偏高频套利策略
from 优矿
    基于日内高低点数据统计的交易策略
    -   N（300）日内高低点出现在各个时间段的分布(如: 高点 第一小时 40%  第二小时 10%  第三小时 15% 第四小时 35%)  也可以为统计区间平均价的高低（如TWAP，VWAP）等
                                   (如: 低点 第一小时 35%  第二小时 15%  第三小时 14% 第四小时 36%)
    -   先建仓，然后每天做T策略如下：
        既然第一个小时有40%的概率为高点，那么可以卖出40%的股票，同时买入35%的股票，综合为卖出5%
        余下时间类似
    -   寄希望于整个过程能够产生符合高低点策略的财务回报
        可以统计市场时间段平均价代替最高最低价
    -   风险： 1 这个概率是否是一个稳定的现象，是否可以选股以选择更合适的操作品种
              2 是否有足够高的收益覆盖成本
              3 建仓多少才能够有足够的收益

< 小知识 >  数据处理基本方法 
from 优矿
    去极值化 winsorize：根据样本计算平均值和标准差, 平均值±3标准差意外的数据取边界值，如：市值等可以考虑，消除极值因子的影响
    中性化  neutralize：对于不同行业的股票，其PE基准值可能不一样，无法直接比较，中性化处理后可以进行比较
    标准化  standardize：(因子值 - 因子均值)/因子标准差, 这样不同因子之间才可进行比较分析或者加权计算

< 小知识 >  量化投资基本流派

< 思考 > 海龟交易法则

< 小知识 > 凯利公式
    资金大了之后的有效管理方式
    f = (pb - q)/b  p: 胜率  q: 败率  b: 净赢率(loss为1情况下的简要计算值)
    f = p - q/(w/l) w: win净盈率  l: loss净损率  或者 简单计算为 f = p -q/r   其中 r = w/l 即赔率
    f: 仓位比例

< 熔断超跌错杀股的一种判断方式 >
    第一次熔断为红盘，第二次熔断时杀跌
    首次熔断前小跌，第二次熔断杀跌
    首次熔断后杀跌，但有明显拉升，且第二次熔断后价格竟然高与第一次熔断价格

< 技术指标 >
    MA: sum(price[0:N])/N
    ATR: 真实波动幅度
        TR  = max(high - low, high - lastClose, lastClose - low)
        stdTR = tr / close
        ATR = average(TR[0:N])
        stdATR= average(stdTR[0:N])
    AMA:
    MACD:
    DBCD:
    KDJ:
    RSI:
    zigzag:
    itrend:
        price = (high + low)/2.0;
        if (bars.len() < 7){
            // 初始Trend的计算
            if (bars.len() >= 3){
                trend = (price + 2*price[1] + price[2])/4;
            }
        }else{
            trend = (alpha - alpha*alpha/4)*price + 0.5*alpha*alpha*price[1] -
                    (alpha-0.75*alpha*alpha)*price[2]
                    + 2*(1-alpha)*trend[1] - 
                    (1-alpha)*(1-alpha)*trend[2]
        }